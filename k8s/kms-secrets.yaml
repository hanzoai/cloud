# Hanzo Cloud runtime secrets via Hanzo KMS (native KMS operator).
#
# Prerequisites:
# 1) KMS operator (KMSSecret CRD) is installed in the target cluster.
# 2) Project "cloud" with env "prod" exists in Hanzo KMS.
# 3) Path "/" in that project contains these keys:
#    - dataSourceName
#    - iamEndpoint
#    - clientId
#    - clientSecret
#    - HANZO_API_KEY
#    - KMS_ENDPOINT
#    - KMS_CLIENT_ID
#    - KMS_CLIENT_SECRET
#    - KMS_PROJECT_ID
#    - KMS_ENVIRONMENT
#
# The operator syncs those keys into Secret: cloud-runtime-secrets.
---
apiVersion: v1
kind: Secret
metadata:
  name: kms-auth
  namespace: hanzo
  labels:
    app.kubernetes.io/name: cloud-api
    app.kubernetes.io/component: kms-auth
    app.kubernetes.io/part-of: hanzo-cloud
type: Opaque
stringData:
  clientId: ""      # KMS machine identity client ID
  clientSecret: ""  # KMS machine identity client secret
---
apiVersion: secrets.lux.network/v1alpha1
kind: KMSSecret
metadata:
  name: cloud-runtime-kms-sync
  namespace: hanzo
  labels:
    app.kubernetes.io/name: cloud-api
    app.kubernetes.io/component: secrets
    app.kubernetes.io/part-of: hanzo-cloud
spec:
  hostAPI: https://kms.hanzo.ai
  resyncInterval: 60
  authentication:
    universalAuth:
      credentialsRef:
        secretName: kms-auth
        secretNamespace: hanzo
      secretsScope:
        projectSlug: cloud
        envSlug: prod
        secretsPath: /
  managedSecretReference:
    secretName: cloud-runtime-secrets
    secretNamespace: hanzo
    secretType: Opaque
